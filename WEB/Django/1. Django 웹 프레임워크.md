# Django 웹 프레임워크

2020.03.26

### web framework

- 웹 개발 시
  1. A - Z 모두 직접 하기
  2. 프레임워크 사용 (프렌차이저와 같음)
- 웹 통신
  - 요청 & 응답(response, HTML 의 한장의 문서를 받을 뿐)
  - 서버 & 클라이언트

### django

- 파이썬 기반의 웹 프레임워크(웹 개발에 필요한 소스코드 제공)
- 다양한 기업들에서 활용 (instagram, dropbox, Delivery Hero)

#### 어떻게 동작하는가?

파이썬으로 작성된 오픈소스 웹 어플리케이션 프레임 워크로 **모델 뷰 컨트롤러**(Model-View-Controller, 소프트웨어 디자인 패턴)

| MVC 패턴                                                     | django                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| Model View Controller                                        | Model Template View                                          |
| Model : DB 조작 <br />View : 화면에서 보이는 부분<br />일반적 | Model : 데이터 관리<br />Template : 인터페이스(화면) <br />View : 중간 관리(상호작용) |

![11](https://user-images.githubusercontent.com/60081201/77765454-a1734680-7081-11ea-8f2b-79ea8b332381.JPG)

#### AWS Cloud9

- 브라우저에서 직접 코드 작성, 실행 및 디버깅 할 수 있는 클라우드 기반 IDE(통합 개발 환경)
- 개별 로컬 PC 환경에 영향 X 장점
- 추후에 로컬 개발 환경 설정도 진행할 예정

### hello, django!

> 항상 directory 위치 확인하면서 코딩하기!

#### 1. 패키지 설치 

```bash
$ pip install django==2.1.15
```

- 수업에서는 2.1. 15를 기준으로 진행할 예정

#### 2. 프로젝트 생성

```bash
$ django-admin startproject {프로젝트 명}
```

```bash
$ django-admin startproject {프로젝트 명} .
# . : 상위 폴더로 안묶이고 하나만 생김!
```

- 프로젝트 만든 후 항상 로켓 확인하기

  ```bash
  $ python manage.py runserver 8080
  # disallowed 에 대해 '*'를 추가하여 해결하기!
  ```

- 프로젝트 setting

  ![2](https://user-images.githubusercontent.com/60081201/77765237-4c373500-7081-11ea-888f-732504113ebe.JPG)

#### 3. app 생성

- django는 여러개의 앱을 가진 하나의 프로젝트로 구성된다.
  - 커뮤니티를 만든다
    - 회원과 관련된 app - `account`
    - 게실글과 관련된 app - `posts`

```bash
$ python manage.py startapp {app 이름}
```

- app을 생성하고 반드시 `settings.py`의 app에 추가!

#### 4. 서버 실행

- `django_intro` 폴더의 `settings.py` 파일에 아래와 같이 수정한다.

  ```python
  # 28번째 라인
  ALLOWED_HOSTS = ['*']
  ```

- 반드시 서버 실행시 명령어가 실행되는 디렉토리를 확인할 것

```bash
~/ $ cd django_intro/
~/django_intro/ $ python manage.py runserver 8080
```

- 실행된 서버는 우측의 영역의 url을 클릭한다.

- 서버 종료시 터미널에 `ctrl + c` 입력

- python manage.py runserver 

  py 파일을 실행시킨다.

  서버 실행시 ls 명령어를 통해 확인후 실행하도록!

### 리눅스 명령어 정리

- `cd` : change directory, **이동**

  - .. : 상위 디렉토리로
  - . : 현재 디렉토리로

  ```bash
  # django_intro 폴더로 이동
  ~/- $ cd django_intro/
  ~/django_intro $
  
  # 상위 디렉토리로 이동
  ~/django_intro $ cd ..
  ~/ $
  ```

- `ls ` : 현재 디렉토리 파일 **목록**

  ```bash
  ~/django_intro $ ls
  db.sqlite3 django_intro / mannage.py*
  ```

- `mkdir + {파일명}` : make a directory, 파일만들기
- `ctrl + l` : 터미널 clear

### 흐름 정리

1. url 정의 (사용자 경로, 이정표)

2. 함수 `views.py` 에서 정의

   ※ 주의 : 첫인자는 request ! , return에서도 순서대로

   ex) `return(request, html, context)`

   - html : 경로, `template/ ` 자체가 기본 설정(작성하면 X)
   - context - {{ **key** 값 }}

---

### Variable routing

> url의 특정 위치의 값을 변수로 활용

#### 1. urls.py

```python
# django_intro/urls.py
path('hi/<str:name>', views.hi),
path('add/<int:a>/<int:a>', views.add)
```

#### 2. views.py

```python
# pages/views.py
def hi(request, name):
    context = {
        'name': name
    }
    return render(request, 'hi.html', context)
```

#### 3. template

- template에서 대괄호 X, 소괄호 X --> `.`으로 표현
- 표현 정리
  - `{{ }}` : 출력하고 싶은 내용
  - `{% %}` : logic 문법, 출력 X
  - `{# #}` : 주석

```html
<!--pages/templates/hi.html-->
<h1>
    안녕, {{ name }}
</h1>
```

### DTL

> 템플릿파일(html)은 django template language를 통해 구성할 수 있다.

1. 출력

   ```html
   {{ menu }}
   {{ menu.0 }}
   ```

2. 문법 `{% %}`

   ```html
   {% for menu in menupan %}
   {% endfor %}
   ```

### 어제 오늘 배운거 총정리!

- 웹서버는 요청을 받아서 응답을 처리한다.
- 응답을 처리할 때 url정의되고 view 실행되도록하는 데 여기서는 python 코드가 동작
- html 문서만들기 위해서는 템플릿이 노력하는데 템플릿이 변수를 넘겨주기 위해서는 context 딕셔너리로 넘겨준다.
- context는 html  문서를 만들 때 조건문과 반복문으로 다양한 구성가능하다 url에서 변수로 사용할 수 있다

---

# django 실습

## 준비과정 정리

1. 터미널 창에서 `cd practice/(원하는 폴더로)` 로 작업할 폴더로 이동
2. `mkdir (폴더 생성 ex.exercise)` 후 `cd exercise` 그 폴더로 이동
3. `dgango-admin startproject (프로젝트 파일 명 ex.intro)` 프로젝트 생성
4. `cd intro` 생성한 프로젝트로 들어가서 `ls` 검색
5. `manage.py` 확인 후 

### posts

> 2020.03.30

- template 활용
  - DTL (django Template Language)

1. urls.py

   ```python
   # urlpatterns 리스트에 추가
   path('posts/<int:id>/', views.posts),
   ```

2. views.py

   ```python
   def posts(request, id):
       content = 'Life is short, you need python!'
       replies = ['유익한 글이네요!', '재밌어요.', '도움이 되네요']
       user = 'admin'
       no_replies = []
       context = {
           'id' : id,
           'content': content,
           'replies': replies,
           'no_replies': no_replies,
           'user': user,
       }
       return render(request, 'post.html', context)
   ```

3. pages/templates/post.html

   ```html
   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <meta http-equiv="X-UA-Compatible" content="ie=edge">
       <title>Document</title>
   </head>
   <body>
       <h1>{{ id }}번째 글입니다.</h1>
       <p>{{ content }}</p>
       <p>{{ content|length }}글자</p>
       <p>{{ content|truncatechars:10 }}</p>
       <hr>
       <!--댓글 출력 반복-->
       <h2>댓글</h2>
       <ul>
       {% for reply in replies %}
           <li>{{ reply }}</li>
       {% endfor %}
       </ul>
       <ul>
       {% for reply in replies %}
           <li>댓글{{ forloop.counter }} : {{ reply }}</li>
       {% endfor %}
       </ul>
       <ul>
       {% for reply in no_replies %}
           <li>댓글{{ forloop.counter }} : {{ reply }}</li>
           {% empty %}
           <p>댓글이 없습니다. 작성해주세요.</p>
       {% endfor %}
       </ul>
       {% if user == 'admin' %}
           <p>수정, 삭제</p>
       {% else %}
           <p>관리자 권한이 없습니다.</p>
       {% endif %}
   </body>
   ```

   - `forloop.counter` : for ~ endfor 안에서 사용
   - `empty` : 비어있을 때 사용
   - `{{ content|truncatechars:10 }}` : 글자수 잘라서 보여주는 기능
   - `|` : filter 

4. base.html을 이용하여 작성

   - base.html

   ```html
   <!DOCTYPE html>
   <html lang="ko">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <meta http-equiv="X-UA-Compatible" content="ie=edge">
       <title>Django 기초 - pages</title>
   </head>
   <body>
       <h1>Django 기초 문법 학습</h1>
       {% block body %}
       {% end block %}
   </body>
   ```

   - post.html

   ```html
   {% extends 'base.html' %}
   
   
   {% block css %}
   <style>
       h1 {
           color: blue;
       }
   </style>
   {% endblock %}
   
   {% block body %}
       <h1>{{ id }}번째 글입니다.</h1>
       <p>{{ content }}</p>
       <p>{{ content|length }}글자</p>
       <p>{{ content|truncatechars:10 }}</p>
       <hr>
       <!--댓글 출력 반복-->
       <h2>댓글</h2>
       <ul>
       {% for reply in replies %}
           <li>{{ reply }}</li>
       {% endfor %}
       </ul>
       <ul>
       {% for reply in replies %}
           <li>댓글{{ forloop.counter }} : {{ reply }}</li>
       {% endfor %}
       </ul>
       <ul>
       {% for reply in no_replies %}
           <li>댓글{{ forloop.counter }} : {{ reply }}</li>
           {% empty %}
           <p>댓글이 없습니다. 작성해주세요.</p>
       {% endfor %}
       </ul>
       {% if user == 'admin' %}
           <p>수정, 삭제</p>
       {% else %}
           <p>관리자 권한이 없습니다.</p>
       {% endif %}
   {% endblock %}
   ```

5. 화면

![4](https://user-images.githubusercontent.com/60081201/77871782-2330c300-7280-11ea-84a4-1debea2a9336.JPG)

### base.html로 모든 templates 적용하기

1. base.html 생성

```htmL
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Django 기초 - pages</title>
</head>
<body>
    <h1>Django 기초 문법 학습</h1>
    {% block body %}
    {% end block %}
</body>
</html>
```

2. 확장해서 사용할 html 에 head, body 다지워주고 블록들을 만들어주면 된다.

   기본으로 할 html  **맨위에 최!상!단! 고정**`{% extends 'base.html' %}` (두개를 확장할 수 X)

   이름 지칭해주는거 동일하게!

```html
{% extends 'base.html' %}

{% block body %}
    """ body에 들어갈 부분 추가하면 끝 """
{% endblock %}
```



### post + 사용자 입력 보여주기

다중 app활용

---

### ping pong

> 2020.03.31

- ping : 정보 받기
- pong : 정보 출력

#### 사용자 정보 받기 form

1. urls.py

   ```python
   # boards/urls.py
   urlpatterns = [
       path('ping/', views.ping),
   ]
   ```

2. views.py

   ```python
   # boards/views.py
   def ping(request):
       return render(request, 'boards/ping.html')
   ```

3. ping.html

   - form : action 설정 중요
   - action : 정보를 처리할 함수를 내부적으로 urls 만들어주는 것

   ```html
   <!-- boards/templates/boards/ping.html -->
   <form action="/boards/pong/">
       메시지 입력 : <input type="text" name="message">
       <input type="submit">
   </form>
   ```

#### 정보처리

1. urls.py

   ```python
   # boards/urls.py
   urlpatterns = [
       path('ping/', views.ping),
       path('pong/', views.pong)
   ]
   ```

2. views.py

   ```python
   # boards/views.py
   from requests import requests
   def ping(request):
       return render(request, 'boards/ping.html')
   
   def pong(request):
       # 정보 받기
       messages = request.GET.get('message') #--> input name과 동일하게!
       # template 변수
       context = {
           'messages': messages
       }
       return render(request, 'boards/pong.html', context)
   ```

3. pong.html

   ```html
   <h1>{{ message }}</h1>
   ```

--> 흐름, login 익숙해지기

---

- view --> url, request (요청 관련 정보), return render()
- template --> render 함, html, DTL, 반복 조건 필터
- model ★ --> DB

### model

DB에 대한 model --> 서비스에 대한 영향

#### 1. 스키마

스키마를 통해 각각 colum들의 타입 지정 가능!!

효과적으로 관리하기 위해서

각 열들에 데이터 타입을 가질지 미리 정의

#### 2. table

큰 데이터 베이스에는 여러개의 table 존재

행과 열로 구성

- 행 = **row** = 레코드
- 열 = **column** = 속성 = 필드

### DB 조작 언어

- SQL
- ORM : 이용하여 조작할 예정
  - Object Relational(DB) Mapper 객체 관계 매핑 
  - 파이썬 객체 조작(메서드 호출)으로 DB를 조작한다.

### 실습

1. 새로운 프로젝트 만들고 setting에서 '*', ko-kr 기본 세팅

2. 앱 만들기  articles

   1. setting에서 INSTALLED_APPS에 앱 등록
   2. urls 에 등록 (프로젝트 별 관리를 위해)

   ```python
   from django.contrib import admin
   from django.urls import path, include
   
   urlpatterns = [
       path('admin/', admin.site.urls),
       path('articles/', include('articles.urls'))
   ]
   ```

   3. articles에 새로운 파일 urls.py 생성

      뼈대 만들기

   ```python
   from django.urls import path
   
   urlpatterns = [
   ]
   ```

3. 본격적으로 model 시작

   클래스 만들기

   DB 모델링

   ```python
   # articles/models.py
   from django.db import models
   
   # Create your models here.
   class Article(models.Model):
       title = models.CharField(max_length=140)
       content = models.TextField()
       created_at = models.DateTimeField(auto_now_add=True)
       updated_at = models.DateTimeField(auto_now=True)
   ```

4. 터미널 창에 `python.manage.py makemigrations` 입력 : 모델링 한것을 DB에 반영할 준비

   이후 `python manage.py migrate` 입력 : DB에 반영

5. DB에 반영되어 있는지 살펴보기 위해서 `admin.py` 활용

   ```python
   from django.contrib import admin
   
   # Register your models here.
   from .models import Article
   
   admin.site.register(Article)
   ```

#### 직접 article 조작

1. 터미널에 `pip install django-extensions ipython` 설치하기

2. 터미널에 `python manage.py shell_plus `  --> 주피터 노트북 같다

3. 데이터 게시물의 object 조작 가능

4. method 조작

   CRUD method

   - Create 생성

   - Read 조회

     id : PrimaryKey(PK)

     - Article.objects.all()
     - Article.objects.get(id=2) 

   - Update 수정

     

   - Delate 삭제

     - a.delete()

---

2020.03.30

### django 어떻게 동작하는가?

1. url 을 정의한다.
2. Views.py에 실행할 함수를 만든다.
3. 변환할 html 파일을 만든다.

#### `render()`[¶](https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/#render)

- `render`(*request*, *template_name*, *context=None*, *content_type=None*, *status=None*, *using=None*)

핵심은 MTV 에서 T가 단순히 html이 아니라 실제로 html 만들어나가는 template 엔진이 존재한다 기억하기

- 흔히 실수 : 주석처리는 {#여기에 주석쓰기#}

https://docs.djangoproject.com/ko/2.1/ref/templates/language/

https://docs.djangoproject.com/ko/2.1/ref/templates/builtins/

---

## 문법 정리

### 반복문

```html
{% for reply in replies %}
	<li>{{ reply }}</li>
{% endfor %}
```

DTL에서 연산 X, python 코드 X

--> 연산은 views.py에서 완료! context에 완료한 계산된 결과를 보여주는 것!!

- {{ forloop.counter }}
- {{ forloop.counter0 }}
- {% empty %}

### 조건문

```html
{% if user == 'admin' %}
	<p>관리자 입니다.</p>
{% else %}
	<p>권한이 없습니다.</p>
{% endif %}
```

### built-in tag, filter

```html
{{ content|length }}
{{ content|truncatechars:10 }}
```

---

### Django coding style

https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/

import 순서 참고하기